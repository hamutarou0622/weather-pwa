<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Êöá„Å§„Å∂„Åó„Çµ„Ç§„Éà + ‰ªäÊó•„ÅÆÂ§©Ê∞ó</title>
  <meta name="theme-color" content="#111111" />
  <link rel="manifest" href="manifest.json" />
  <link rel="apple-touch-icon" href="icons/icon-192.png" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    /* ============ Êó¢Â≠ò„Çπ„Çø„Ç§„É´ ============ */
    body { font-family: 'Helvetica Neue', Arial, sans-serif; margin:0; padding:0; background-color:#1a1a1a; color:#f5f5f5; overflow-x:hidden; scroll-behavior:smooth; }
    .background { position:fixed; top:0; left:0; width:100%; height:100%; z-index:-2; background-size:cover; background-position:center; transition:opacity 1s ease-in-out; opacity:0; }
    .background.active { opacity:1; }
    header { background-color:#111; color:white; padding:1.5em 0; text-align:center; letter-spacing:1px; border-bottom:2px solid #444; box-shadow:0 4px 8px rgba(0,0,0,.5); position:relative; }
    header h1 { margin:0; font-weight:300; font-size:3em; letter-spacing:.1em; animation:fadeIn 2s ease-in-out; }
    @keyframes fadeIn { from{opacity:0; transform:translateY(-20px);} to{opacity:1; transform:translateY(0);} }
    .section-container { margin:40px auto; max-width:1200px; padding:20px; background-color:rgba(255,255,255,.1); border-radius:10px; box-shadow:0 8px 16px rgba(0,0,0,.2); opacity:0; transform:translateY(50px); transition:opacity .6s ease-out, transform .6s ease-out; }
    .visible { opacity:1; transform:translateY(0); }
    .hidden-button { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); background:transparent; border:none; width:200px; height:100px; cursor:pointer; outline:none; transition:background-color .5s ease; z-index:10; }
    .hidden-button:hover { background-color:yellow; }
    .flame-bg { position:relative; width:100%; height:500px; background:url('https://i.gifer.com/OzG.gif') no-repeat center/cover; overflow:hidden; border-radius:10px; box-shadow:0 4px 8px rgba(0,0,0,.3); animation:scaleIn 2s ease-in-out; }
    .goal-text { position:absolute; top:50%; left:100%; font-family:'Impact', sans-serif; font-size:200px; font-weight:bold; color:#ff0000; transform:translateY(-50%); white-space:nowrap; animation:slideGoal 5s cubic-bezier(.42,0,.58,1) infinite; text-shadow:4px 4px 8px rgba(0,0,0,.7); }
    @keyframes scaleIn { from{transform:scale(.9); opacity:.5;} to{transform:scale(1); opacity:1;} }
    @keyframes slideGoal { 0%{ left:100%; transform:translateY(-50%) scale(.8);} 20%{ left:50%; transform:translateY(-50%) scale(1.1);} 40%{ left:0%; transform:translateY(-50%) scale(1);} 60%{ left:-50%; transform:translateY(-50%) scale(1.1);} 100%{ left:-100%; transform:translateY(-50%) scale(.8);} }
    .tasks-playlist { display:flex; justify-content:space-between; gap:20px; margin-top:20px; }
    .todo-list, .playlist { width:48%; padding:20px; border-radius:8px; background-color:#2a2a2a; box-shadow:0 4px 8px rgba(0,0,0,.3); animation:fadeInUp 1s ease-in-out; }
    @keyframes fadeInUp { from{ opacity:0; transform:translateY(20px);} to{ opacity:1; transform:translateY(0);} }
    .todo-list h2, .playlist h2 { font-size:1.8em; margin-bottom:20px; color:#f5f5f5; font-weight:500; border-bottom:2px solid #444; padding-bottom:10px; }
    #todo-items, #playlist-items { list-style:none; padding:0; margin:0; }
    #todo-items li, #playlist-items li { padding:12px; margin-bottom:10px; background-color:#333; border-radius:6px; display:flex; justify-content:space-between; align-items:center; box-shadow:0 2px 4px rgba(0,0,0,.2); transition:box-shadow .3s ease, transform .3s ease; }
    #todo-items li:hover, #playlist-items li:hover { box-shadow:0 4px 8px rgba(0,0,0,.3); transform:translateY(-3px); }
    #todo-items li button, #playlist-items li button { background-color:#ff4d4d; color:white; border:none; padding:6px 12px; border-radius:4px; cursor:pointer; transition:background-color .2s ease; }
    #todo-items li button:hover, #playlist-items li button:hover { background-color:#ff1a1a; }
    input[type="text"], input[type="file"], input[type="password"] { width:100%; padding:12px; border-radius:4px; border:1px solid #444; margin-bottom:10px; box-sizing:border-box; background-color:#2a2a2a; color:#f5f5f5; transition:border-color .3s ease; }
    input[type="text"]:focus, input[type="file"]:focus, input[type="password"]:focus { border-color:#007bff; outline:none; }
    button { background-color:#007bff; color:white; padding:10px 20px; border:none; border-radius:4px; cursor:pointer; font-size:16px; transition:background-color .3s ease, transform .3s ease; }
    button:hover { background-color:#0056b3; transform:translateY(-3px); }
    .soccer-scoreboard iframe, .league-widget iframe { width:100%; height:500px; border-radius:8px; border:none; box-shadow:0 4px 8px rgba(0,0,0,.2); transition:transform .3s ease; }
    .soccer-scoreboard iframe:hover, .league-widget iframe:hover { transform:scale(1.02); }
    .audio-player { display:flex; flex-direction:column; align-items:center; background-color:#2a2a2a; padding:20px; border-radius:8px; box-shadow:0 4px 8px rgba(0,0,0,.3); animation:fadeInUp 1s ease-in-out; }
    .audio-player audio { width:100%; margin-top:20px; border-radius:8px; background-color:#444; }
    footer { text-align:center; padding:2em 0; background-color:#111; color:white; font-size:14px; border-top:2px solid #444; box-shadow:0 -4px 8px rgba(0,0,0,.5); animation:fadeIn 2s ease-in-out; }
    #protected-content { display:none; }
    /* üí©: 15Áßí‰∏äÈôêÔºà1Âõû„ÅÆ„ÅøÔºâ */
    .poop-emoji { font-size:50px; position:fixed; top:-50px; z-index:9999; animation: fall var(--dur, 5s) linear 1; text-shadow:0 0 10px rgba(255,255,0,.75); }
    @keyframes fall { to{ transform:translateY(100vh) rotate(360deg);} }
    .poop-emoji::before { content:'üí©'; color:#ff0000; animation:poopGlow 2s linear infinite alternate; }
    @keyframes poopGlow { 0%{ text-shadow:0 0 10px rgba(255,0,0,.5);} 100%{ text-shadow:0 0 20px rgba(255,255,0,1);} }
    .calendar-container { display:flex; justify-content:space-between; align-items:flex-start; gap:20px; }
    #calendar-header { display:flex; justify-content:space-between; align-items:center; }
    #calendar-header button { background-color:#007bff; color:white; padding:10px 20px; border:none; border-radius:4px; cursor:pointer; font-size:16px; transition:background-color .3s ease, transform .3s ease; }
    #calendar-header button:hover { background-color:#0056b3; transform:translateY(-3px); }
    #calendar { flex:1; }
    table.calendar { width:100%; background-color:#444; border-collapse:collapse; border-radius:8px; overflow:hidden; }
    table.calendar th, table.calendar td { padding:10px; text-align:center; border:1px solid #666; color:#f5f5f5; cursor:pointer; }
    table.calendar th { background-color:#333; }
    table.calendar td:hover { background-color:#555; }
    .selected-date { background-color:#007bff; }
    .memo-display { background-color:#2a2a2a; color:#f5f5f5; padding:20px; border-radius:8px; margin-top:20px; display:none; }
    #calendar-memo { width:300px; padding:20px; background-color:#2a2a2a; border-radius:8px; box-shadow:0 4px 8px rgba(0,0,0,.3); }
    #calendar-memo textarea { width:100%; height:200px; padding:10px; border-radius:4px; background-color:#333; color:#f5f5f5; border:1px solid #444; resize:none; }
    #calendar-memo button { margin-top:10px; }

    /* ============ ËøΩÂä†ÔºöÂ§©Ê∞ó„Ç´„Éº„Éâ & PWAÊìç‰Ωú ============ */
    .topbar-actions { position:absolute; top:12px; right:12px; display:flex; gap:8px; }
    .pwa-ghost { background:#222; color:#fff; border-radius:10px; padding:8px 12px; font-size:12px; border:1px solid #333; }
    .weather-card { display:grid; grid-template-columns:1fr auto; gap:12px; align-items:center; background:#222; border:1px solid #333; border-radius:12px; padding:14px; }
    .weather-main { display:flex; gap:16px; align-items:flex-end; }
    .weather-big { font-size:34px; line-height:1; }
    .muted { color:#aaa; }
    .two-grid { display:grid; grid-template-columns:1fr 1fr; gap:8px; }
    .tiny { font-size:12px; }
    @media (max-width: 768px){ .tasks-playlist { flex-direction:column; } #calendar-memo{ width:100%; } .goal-text{ font-size:120px; } }
  </style>
</head>
<body>
  <!-- ËÉåÊôØ -->
  <div id="particle-background" class="background active" style="background-image:url('https://i.gifer.com/9viJ.gif');"></div>
  <div id="sky-background" class="background" style="background-image:url('https://i.gifer.com/bF4.gif');"></div>
  <div id="earth-background" class="background" style="background-image:url('https://i.gifer.com/NSu6.gif');"></div>

  <header>
    <h1>Êöá„Å§„Å∂„Åó„Çµ„Ç§„Éà</h1>
    <!-- Èö†„Åó„Éú„Çø„É≥ÔºàÈòøÈÉ®ÂØõÔºâ -->
    <button class="hidden-button" onclick="redirectToAbePage()"></button>
    <!-- PWA Êìç‰ΩúÁî® -->
    <div class="topbar-actions">
      <button id="installBtn" class="pwa-ghost" style="display:none">„Ç§„É≥„Çπ„Éà„Éº„É´</button>
      <button id="notifyBtn" class="pwa-ghost">ÈÄöÁü•</button>
    </div>
  </header>

  <!-- ‚òÖ ËøΩÂä†Ôºö‰ªäÊó•„ÅÆÂ§©Ê∞óÔºà+ÊòéÊó•Ôºâ -->
  <section class="section-container" id="weather-section">
    <h2><i class="fa-solid fa-cloud-sun"></i> ‰ªäÊó•„Å®ÊòéÊó•„ÅÆÂ§©Ê∞ó</h2>
    <div class="weather-card">
      <div class="weather-main">
        <div>
          <div class="tiny muted">Âú∞ÁÇπ</div>
          <div id="placeLabel">‚Äî</div>
          <div class="tiny muted" id="updatedLabel">Êõ¥Êñ∞: ‚Äî</div>
        </div>
        <div>
          <div id="todayTemp" class="weather-big">--‚ÑÉ</div>
          <div id="todayRange" class="muted">‰ªäÊó•: ÊúÄÈ´ò --‚ÑÉ / ÊúÄ‰Ωé --‚ÑÉ</div>
          <div id="todayPop" class="muted">ÈôçÊ∞¥Á¢∫Áéá --%</div>
          <div style="height:8px"></div>
          <div id="tomorrowRange" class="muted">ÊòéÊó•: ÊúÄÈ´ò --‚ÑÉ / ÊúÄ‰Ωé --‚ÑÉ</div>
          <div id="tomorrowPop" class="muted">ÈôçÊ∞¥Á¢∫Áéá --%</div>
        </div>
      </div>
      <div class="two-grid">
        <button id="useGeo">ÁèæÂú®Âú∞„Åã„ÇâÂèñÂæó</button>
        <button id="openSettings">Âú∞ÁÇπ„ÇíË®≠ÂÆö</button>
      </div>
    </div>

    <!-- Ë®≠ÂÆö„É¢„Éº„ÉÄ„É´È¢®„Ç´„Éº„Éâ -->
    <div class="section-container" id="settings" style="display:none; padding:16px;">
      <div class="tiny muted">ÈÉΩÂ∏ÇÂêçÔºà‰æã: Kiyosu, Aichi, JPÔºâ</div>
      <input type="text" id="cityInput" placeholder="ÈÉΩÂ∏ÇÂêçÔºàËã±Ë™ûÊé®Â•®Ôºâ" />
      <div class="tiny muted" style="margin-top:8px;">* Ê≠£Á¢∫„Å´Âá∫„Åó„Åü„ÅÑÂ†¥Âêà„ÅØÁ∑ØÂ∫¶ÁµåÂ∫¶„Çí‰Ωø„ÅÑ„Åæ„ÅôÔºà‰æã: 35.1815, 136.9066Ôºâ„ÄÇ</div>
      <div class="tiny muted" style="margin-top:8px;">Á∑ØÂ∫¶, ÁµåÂ∫¶Ôºà‰ªªÊÑèÔºâ</div>
      <input type="text" id="latlonInput" placeholder="35.1815, 136.9066" />
      <div style="display:flex; gap:8px; margin-top:8px;">
        <button id="saveCity">‰øùÂ≠ò„Åó„Å¶Êõ¥Êñ∞</button>
        <button id="closeSettings">Èñâ„Åò„Çã</button>
      </div>
      <div class="tiny muted" style="margin-top:8px;">‚Äª ÂàùÂõû„ÅØ‰ΩçÁΩÆÊÉÖÂ†±„ÅÆË®±ÂèØ„ÅåÂøÖË¶Å„Åß„Åô„ÄÇÊãíÂê¶„Åó„ÅüÂ†¥Âêà„ÅØ„ÄåÂú∞ÁÇπ„ÇíË®≠ÂÆö„Äç„Åã„ÇâÈÉΩÂ∏ÇÂêç„ÅßÂèñÂæó„Åß„Åç„Åæ„Åô„ÄÇ</div>
    </div>
  </section>

  <!-- Êó¢Â≠òÔºöGOOOAL „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ -->
  <section class="flame-bg section-container" id="goal-animation-section">
    <div class="goal-text">GOOOAL</div>
  </section>

  <!-- Êó¢Â≠òÔºöÁõÆÊ¨°„Å®ToDo„É™„Çπ„Éà -->
  <section class="tasks-playlist section-container" id="todo-list-section">
    <div class="todo-list">
      <h2><i class="fas fa-tasks"></i> To Do List</h2>
      <ul id="todo-items"></ul>
      <input type="text" id="todo-input" placeholder="Êñ∞„Åó„ÅÑ„Çø„Çπ„ÇØ„ÇíËøΩÂä†" />
      <button onclick="addTodo()">ËøΩÂä†</button>
    </div>
    <div class="playlist">
      <h2><i class="fas fa-list"></i> ÁõÆÊ¨°</h2>
      <ul id="playlist-items">
        <li><a href="#goal-animation-section">GOOOAL „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥</a></li>
        <li><a href="#todo-list-section">To Do „É™„Çπ„Éà</a></li>
        <li><a href="#soccer-scoreboard-section">Êà¶Ë°ì„Éú„Éº„Éâ</a></li>
        <li><a href="#laliga-widget-section">„É©„Éª„É™„Éº„Ç¨</a></li>
        <li><a href="#premierleague-widget-section">„Éó„É¨„Éü„Ç¢„É™„Éº„Ç∞</a></li>
        <li><a href="#calendar-section">„Ç´„É¨„É≥„ÉÄ„Éº</a></li>
        <li><a href="#password-protected-section">„Éë„Çπ„ÉØ„Éº„Éâ‰øùË≠∑</a></li>
        <li><a href="#audio-player-section">Èü≥Ê•Ω„Éó„É¨„Éº„É§„Éº</a></li>
        <li><a href="#minitokyo-3d-section">MiniTokyo 3D</a></li>
      </ul>
    </div>
  </section>

  <!-- Êó¢Â≠òÔºöMiniTokyo 3D -->
  <section class="section-container" id="minitokyo-3d-section">
    <h2>MiniTokyo 3D</h2>
    <iframe src="https://minitokyo3d.com/" width="100%" height="600" style="border:none;"></iframe>
  </section>

  <!-- Êó¢Â≠òÔºö„É™„Éº„Ç∞ÊÉÖÂ†±„Ç¶„Ç£„Ç∏„Çß„ÉÉ„Éà -->
  <section class="league-widget section-container" id="laliga-widget-section">
    <h2>„É©„Éª„É™„Éº„Ç¨</h2>
    <iframe src="https://www.bing.com/sportsdetails?q=%E3%83%A9%E3%80%80%E3%83%AA%E3%83%BC%E3%81%8C&sport=Soccer&scenario=League&TimezoneId=Tokyo%20Standard%20Time&league=Soccer_SpainLaLiga&intent=Generic&seasonyear=2024&segment=sports&isl2=true&" frameborder="0" scrolling="yes"></iframe>
  </section>
  <section class="league-widget section-container" id="premierleague-widget-section">
    <h2>„Éó„É¨„Éü„Ç¢„É™„Éº„Ç∞</h2>
    <iframe src="https://www.bing.com/sportsdetails?q=%E3%83%97%E3%83%AC%E3%83%9F%E3%82%A2%E3%83%AA%E3%83%BC%E3%82%B0&sport=Soccer&scenario=League&TimezoneId=Tokyo%20Standard%20Time&league=Soccer_EnglandPremierLeague&intent=Generic&seasonyear=2024&segment=sports&isl2=true&" frameborder="0" scrolling="yes"></iframe>
  </section>

  <!-- Êó¢Â≠òÔºöÊà¶Ë°ì„Éú„Éº„Éâ -->
  <section class="soccer-scoreboard section-container" id="soccer-scoreboard-section">
    <h2>Êà¶Ë°ì„Éú„Éº„Éâ</h2>
    <iframe src="https://www.footballbox.club/tactics-board.html"></iframe>
  </section>

  <!-- Êó¢Â≠òÔºö„Ç´„É¨„É≥„ÉÄ„Éº„Å®„É°„É¢ -->
  <section class="section-container calendar-container" id="calendar-section">
    <div id="calendar-header">
      <button onclick="changeMonth(-1)">ÂâçÊúà</button>
      <h2 id="current-month"><i class="fas fa-calendar-alt"></i> „Ç´„É¨„É≥„ÉÄ„Éº</h2>
      <button onclick="changeMonth(1)">Ê¨°Êúà</button>
    </div>
    <div id="calendar"></div>
    <div id="calendar-memo">
      <h2>„Åì„ÅÆÊó•„ÅÆ„É°„É¢</h2>
      <textarea id="memo-textarea" placeholder="„É°„É¢„ÇíÂÖ•Âäõ..."></textarea>
      <button onclick="saveMemo()">„É°„É¢„Çí‰øùÂ≠ò</button>
    </div>
  </section>
  <div id="memo-display" class="memo-display">
    <h2>„É°„É¢:</h2>
    <p id="memo-content"></p>
  </div>

  <!-- Êó¢Â≠òÔºöÈü≥Ê•Ω„Éó„É¨„Éº„É§„ÉºÔºà‰øÆÊ≠£Ê∏àÔºâ -->
  <section class="section-container audio-player" id="audio-player-section">
    <h2>Èü≥Ê•Ω„Éó„É¨„Éº„É§„Éº</h2>
    <audio id="audio-player" controls></audio>
    <input type="file" id="audio-upload" accept="audio/*" multiple style="display:none" />
    <div style="display:flex; gap:8px; margin-top:8px;">
      <button onclick="addMusic()">Èü≥Ê•Ω„ÇíËøΩÂä†</button>
      <button onclick="playRandom()">„É©„É≥„ÉÄ„É†ÂÜçÁîü</button>
    </div>
    <ul id="playlist"></ul>
  </section>

  <!-- Êó¢Â≠òÔºö„Éë„Çπ„ÉØ„Éº„Éâ‰øùË≠∑Ôºà„É™„É≥„ÇØÂâäÈô§Ê∏à„ÅøÔºâ -->
  <section class="password-protected section-container" id="password-protected-section">
    <h2>„Éë„Çπ„ÉØ„Éº„Éâ‰øùË≠∑</h2>
    <input type="password" id="password-input" placeholder="„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂÖ•Âäõ" />
    <button onclick="checkPassword()">Á¢∫Ë™ç</button>
    <div id="protected-content">
      <p>„Åì„Åì„Å´ÁßòÂØÜ„ÅÆÂÜÖÂÆπ„ÇíË°®Á§∫„Åó„Åæ„Åô„ÄÇ</p>
    </div>
  </section>

  <footer>
    <p>&copy; 2024 Êöá„Å§„Å∂„Åó„Çµ„Ç§„Éà</p>
  </footer>

  <script>
    // ========= ÂÖ±ÈÄöDOMÂèÇÁÖß =========
    let audioFiles = [];
    let audioPlayer = document.getElementById('audio-player');
    const calendar = document.getElementById('calendar');
    const memoTextarea = document.getElementById('memo-textarea');
    const memoDisplay = document.getElementById('memo-display');
    const memoContent = document.getElementById('memo-content');
    const currentMonthDisplay = document.getElementById('current-month');
    let selectedDate = null; let currentYear = new Date().getFullYear(); let currentMonth = new Date().getMonth();

    // ========= ToDo =========
    function addTodo(){ const todoInput=document.getElementById('todo-input'); const todoItems=document.getElementById('todo-items'); const task=todoInput.value.trim(); if(!task){ alert('„Çø„Çπ„ÇØ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ'); return;} const li=document.createElement('li'); li.textContent=task; const del=document.createElement('button'); del.textContent='ÂâäÈô§'; del.onclick=()=>todoItems.removeChild(li); li.appendChild(del); todoItems.appendChild(li); todoInput.value=''; }

    // ========= Èü≥Ê•ΩÔºà‰øÆÊ≠£Ôºö„Éï„Ç°„Ç§„É´ËøΩÂä†ÔºÜÂÜçÁîü„É™„Çπ„ÉàÊßãÁØâÔºâ =========
    function addMusic(){ document.getElementById('audio-upload').click(); }
    document.getElementById('audio-upload').addEventListener('change', (e)=>{
      const files = Array.from(e.target.files).filter(f=>f.type.startsWith('audio/'));
      if(!files.length){ alert('Èü≥Â£∞„Éï„Ç°„Ç§„É´„ÇíÈÅ∏„Çì„Åß„Åè„Å†„Åï„ÅÑ'); return; }
      const list = document.getElementById('playlist');
      files.forEach((f)=>{
        audioFiles.push(f);
        const li = document.createElement('li');
        const title = document.createElement('span');
        title.textContent = f.name + ' ';
        const btn = document.createElement('button');
        btn.textContent = 'ÂÜçÁîü';
        btn.onclick = ()=>{
          try{ if(audioPlayer.src) URL.revokeObjectURL(audioPlayer.src); }catch{}
          audioPlayer.src = URL.createObjectURL(f);
          audioPlayer.play();
        };
        li.appendChild(title); li.appendChild(btn); list.appendChild(li);
      });
      // 1Êõ≤ÁõÆ„ÇíËá™ÂãïÂÜçÁîü
      if(files[0]){
        try{ if(audioPlayer.src) URL.revokeObjectURL(audioPlayer.src); }catch{}
        audioPlayer.src = URL.createObjectURL(files[0]);
        audioPlayer.play();
      }
      e.target.value=''; // Âêå„Åò„Éï„Ç°„Ç§„É´„ÇíÂÜçÈÅ∏Êäû„Åß„Åç„Çã„Çà„ÅÜ„É™„Çª„ÉÉ„Éà
    });

    function playRandom(){ if(audioFiles.length===0){ alert('Èü≥Ê•Ω„ÅåËøΩÂä†„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ'); return;} const i=Math.floor(Math.random()*audioFiles.length); const f=audioFiles[i]; try{ if(audioPlayer.src) URL.revokeObjectURL(audioPlayer.src); }catch{} audioPlayer.src=URL.createObjectURL(f); audioPlayer.play(); }

    // ========= „Éë„Çπ„ÉØ„Éº„ÉâÔºà15Áßí‰∏äÈôêÔºâ =========
    function checkPassword(){ const pw=document.getElementById('password-input').value; const correct='poop'; if(pw===correct){ triggerPoopAnimation(); document.getElementById('protected-content').style.display='block'; } else { alert('„Éë„Çπ„ÉØ„Éº„Éâ„ÅåÈÅï„ÅÑ„Åæ„Åô„ÄÇ'); } }
    function triggerPoopAnimation(){
      const COUNT = 30;
      for(let i=0;i<COUNT;i++){
        let d=document.createElement('div');
        d.textContent='üí©';
        d.classList.add('poop-emoji');
        d.style.left=Math.random()*100+'vw';
        const dur = (Math.random()*10+5).toFixed(2)+'s'; // 5„Äú15Áßí
        d.style.setProperty('--dur', dur);
        document.body.appendChild(d);
        d.addEventListener('animationend',()=>d.remove());
      }
      // Âøµ„ÅÆ„Åü„ÇÅ15ÁßíÂæå„Å´ÊÆãÈ™∏„ÇíÂÖ®ÊéÉÈô§
      setTimeout(()=>{ document.querySelectorAll('.poop-emoji').forEach(x=>x.remove()); }, 15000);
    }

    // ========= „Çπ„ÇØ„É≠„Éº„É´Ë°®Á§∫ =========
    function handleScroll(){ const sections=document.querySelectorAll('.section-container'); sections.forEach(s=>{ const r=s.getBoundingClientRect(); if(r.top<window.innerHeight-100){ s.classList.add('visible'); } }); }
    document.addEventListener('scroll', handleScroll);

    // ========= ËÉåÊôØÂàáÊõø =========
    function cycleBackgrounds(){ const p=document.getElementById('particle-background'); const s=document.getElementById('sky-background'); const e=document.getElementById('earth-background'); let cur='particle'; setInterval(()=>{ if(cur==='particle'){ p.classList.remove('active'); s.classList.add('active'); e.classList.remove('active'); cur='sky'; } else if(cur==='sky'){ p.classList.remove('active'); s.classList.remove('active'); e.classList.add('active'); cur='earth'; } else { p.classList.add('active'); s.classList.remove('active'); e.classList.remove('active'); cur='particle'; } }, 20000); }
    function redirectToAbePage(){ alert('Èö†„Åó„Éú„Çø„É≥„ÇíÁô∫Ë¶ãÔºÅÈòøÈÉ®ÂØõ„ÅÆ„Éõ„Éº„É†„Éö„Éº„Ç∏„Å´ÁßªÂãï„Åó„Åæ„Åô...'); window.location.href='https://abehiroshi.la.coocan.jp/'; }

    // ========= „Ç´„É¨„É≥„ÉÄ„Éº =========
    function createCalendar(year, month){ calendar.innerHTML=''; const daysInMonth=new Date(year, month+1, 0).getDate(); const firstDay=new Date(year, month, 1).getDay(); const table=document.createElement('table'); table.classList.add('calendar'); const thead=document.createElement('thead'); const tbody=document.createElement('tbody'); const headerRow=document.createElement('tr'); ["Êó•","Êúà","ÁÅ´","Ê∞¥","Êú®","Èáë","Âúü"].forEach(d=>{ const th=document.createElement('th'); th.textContent=d; headerRow.appendChild(th); }); thead.appendChild(headerRow); table.appendChild(thead); let row=document.createElement('tr'); for(let i=0;i<firstDay;i++){ row.appendChild(document.createElement('td')); }
      for(let day=1; day<=daysInMonth; day++){ if(row.children.length===7){ tbody.appendChild(row); row=document.createElement('tr'); } const cell=document.createElement('td'); cell.textContent=day; cell.onclick=function(ev){ selectDate(year, month+1, day, ev); }; row.appendChild(cell); }
      tbody.appendChild(row); table.appendChild(tbody); calendar.appendChild(table); updateMonthDisplay(); }
    function updateMonthDisplay(){ const names=["1Êúà","2Êúà","3Êúà","4Êúà","5Êúà","6Êúà","7Êúà","8Êúà","9Êúà","10Êúà","11Êúà","12Êúà"]; currentMonthDisplay.textContent=`${names[currentMonth]} ${currentYear}`; }
    function changeMonth(step){ currentMonth+=step; if(currentMonth<0){ currentMonth=11; currentYear--; } else if(currentMonth>11){ currentMonth=0; currentYear++; } createCalendar(currentYear, currentMonth); }
    function selectDate(year, month, day, ev){ selectedDate=`${year}-${month}-${day}`; document.querySelectorAll('td').forEach(td=>td.classList.remove('selected-date')); ev.target.classList.add('selected-date'); loadMemo(selectedDate); }
    function saveMemo(){ if(!selectedDate){ alert('Êó•‰ªò„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ'); return; } const memoText=memoTextarea.value; if(memoText){ localStorage.setItem(`memo-${selectedDate}`, memoText); alert('„É°„É¢„Åå‰øùÂ≠ò„Åï„Çå„Åæ„Åó„ÅüÔºÅ'); loadMemo(selectedDate); } else { alert('„É°„É¢„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ'); } }
    function loadMemo(date){ const saved=localStorage.getItem(`memo-${date}`); if(saved){ memoContent.textContent=saved; memoDisplay.style.display='block'; } else { memoDisplay.style.display='none'; } }

    // ========= Â§©Ê∞óÔºàOpen‚ÄëMeteoÔºö‰ªäÊó• + ÊòéÊó•Ôºâ =========
    const $q = (s)=>document.querySelector(s);
    const store = { get k(){ return 'pwa.weather.settings.v1'; }, load(){ try{ return JSON.parse(localStorage.getItem(this.k)||'{}'); }catch{ return {}; } }, save(v){ localStorage.setItem(this.k, JSON.stringify(v||{})); } };
    function fmtDate(d){ const z=n=>String(n).padStart(2,'0'); return `${d.getMonth()+1}/${z(d.getDate())} ${z(d.getHours())}:${z(d.getMinutes())}`; }
    async function geocodeCity(name){ const u=new URL('https://geocoding-api.open-meteo.com/v1/search'); u.search=new URLSearchParams({ name, count:1, language:'ja', format:'json' }); const r=await fetch(u); if(!r.ok) throw new Error('geocode fail'); const j=await r.json(); if(!j.results?.length) throw new Error('no results'); const { latitude, longitude, name:n, country }=j.results[0]; return { lat: latitude, lon: longitude, label: country?`${n}, ${country}`: n }; }
    async function fetchWeather(lat, lon){ const u=new URL('https://api.open-meteo.com/v1/forecast'); u.search=new URLSearchParams({ latitude:lat, longitude:lon, daily:'temperature_2m_max,temperature_2m_min,precipitation_probability_max', timezone:'Asia/Tokyo' }); const r=await fetch(u, { cache:'no-store' }); if(!r.ok) throw new Error('wx fail'); return await r.json(); }
    function renderWeather(label, data){ const d=data?.daily||{}; const tmax=d.temperature_2m_max?.[0]; const tmin=d.temperature_2m_min?.[0]; const pop=d.precipitation_probability_max?.[0]; const tmax2=d.temperature_2m_max?.[1]; const tmin2=d.temperature_2m_min?.[1]; const pop2=d.precipitation_probability_max?.[1]; $q('#placeLabel').textContent=label||'‚Äî'; $q('#todayTemp').textContent=Number.isFinite(tmax)&&Number.isFinite(tmin) ? `${Math.round((tmax+tmin)/2)}‚ÑÉ` : '--‚ÑÉ'; $q('#todayRange').textContent=`‰ªäÊó•: ÊúÄÈ´ò ${tmax??'--'}‚ÑÉ / ÊúÄ‰Ωé ${tmin??'--'}‚ÑÉ`; $q('#todayPop').textContent=`ÈôçÊ∞¥Á¢∫Áéá ${pop??'--'}%`; $q('#tomorrowRange').textContent=`ÊòéÊó•: ÊúÄÈ´ò ${tmax2??'--'}‚ÑÉ / ÊúÄ‰Ωé ${tmin2??'--'}‚ÑÉ`; $q('#tomorrowPop').textContent=`ÈôçÊ∞¥Á¢∫Áéá ${pop2??'--'}%`; $q('#updatedLabel').textContent='Êõ¥Êñ∞: '+fmtDate(new Date()); }
    async function updateWeatherFromSettings(){ const s=store.load(); let lat=s.lat, lon=s.lon, label=s.label; try{ if(!lat||!lon){ if(s.city){ const g=await geocodeCity(s.city); lat=g.lat; lon=g.lon; label=g.label; s.lat=lat; s.lon=lon; s.label=label; store.save(s); } else { throw new Error('no location'); } } const wx=await fetchWeather(lat, lon); localStorage.setItem('pwa.weather.cache', JSON.stringify({ when: Date.now(), label, wx })); renderWeather(label, wx); }catch(e){ const cache=JSON.parse(localStorage.getItem('pwa.weather.cache')||'null'); if(cache){ renderWeather(cache.label, cache.wx); } }
    }
    async function useGeolocation(){ try{ const pos=await new Promise((ok, ng)=>navigator.geolocation.getCurrentPosition(ok, ng, { enableHighAccuracy:true, timeout:8000 })); const lat=+pos.coords.latitude.toFixed(4); const lon=+pos.coords.longitude.toFixed(4); const s=store.load(); s.lat=lat; s.lon=lon; s.label=`ÁèæÂú®Âú∞ (${lat}, ${lon})`; delete s.city; store.save(s); updateWeatherFromSettings(); }catch(e){ alert('‰ΩçÁΩÆÊÉÖÂ†±„ÅåÂèñÂæó„Åß„Åç„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇÊ®©Èôê„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ'); } }

    // ========= ÈÄöÁü•ÔºàÁ∞°ÊòìÔºâ =========
    async function requestNotification(){ if(!('Notification' in window)){ alert('„Åì„ÅÆÁ´ØÊú´„ÅØÈÄöÁü•„Å´Êú™ÂØæÂøú„Åß„Åô'); return; } const perm=await Notification.requestPermission(); if(perm!=='granted'){ alert('ÈÄöÁü•„ÅåË®±ÂèØ„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì'); return; } scheduleLocal6amReminder(); alert('ÈÄöÁü•„ÇíË®±ÂèØ„Åó„Åæ„Åó„Åü„ÄÇ6:00„ÅÆ„É™„Éû„Ç§„É≥„Éâ„ÇíË®≠ÂÆö„Åó„Åæ„Åó„ÅüÔºàÂãï‰Ωú„ÅØÁ´ØÊú´‰æùÂ≠òÔºâ'); }
    function msUntilNext6am(){ const now=new Date(); const next=new Date(); next.setHours(6,0,0,0); if(next<=now) next.setDate(next.getDate()+1); return next-now; }
    function scheduleLocal6amReminder(){ const ms=msUntilNext6am(); setTimeout(()=>{ if(Notification.permission==='granted') new Notification('„Åä„ÅØ„Çà„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô', { body:'‰ªäÊó•„Å®ÊòéÊó•„ÅÆÂ§©Ê∞ó„ÇíÁ¢∫Ë™ç„Åó„Åæ„Åó„Çá„ÅÜÔºÅ' }); scheduleLocal6amReminder(); }, ms); }

    // ========= PWAÔºàinstall + SWÔºâ =========
    let deferredPrompt=null; window.addEventListener('beforeinstallprompt', (e)=>{ e.preventDefault(); deferredPrompt=e; document.getElementById('installBtn').style.display='inline-block'; });
    document.getElementById('installBtn').addEventListener('click', async ()=>{ if(!deferredPrompt) return; deferredPrompt.prompt(); await deferredPrompt.userChoice; deferredPrompt=null; document.getElementById('installBtn').style.display='none'; });
    if('serviceWorker' in navigator){ window.addEventListener('load', ()=>{ navigator.serviceWorker.register('./service-worker.js'); }); }

    // ========= „Ç§„Éô„É≥„ÉàÊùü„Å≠ =========
    document.getElementById('useGeo').addEventListener('click', useGeolocation);
    document.getElementById('openSettings').addEventListener('click', ()=> document.getElementById('settings').style.display='block');
    document.getElementById('closeSettings').addEventListener('click', ()=> document.getElementById('settings').style.display='none');
    document.getElementById('saveCity').addEventListener('click', async ()=>{ const city=document.getElementById('cityInput').value.trim(); const latlon=document.getElementById('latlonInput').value.trim(); const s=store.load(); if(latlon){ const m=latlon.split(',').map(x=>parseFloat(x.trim())); if(m.length===2 && m.every(Number.isFinite)){ s.lat=m[0]; s.lon=m[1]; s.label=`(${s.lat}, ${s.lon})`; delete s.city; } else { alert('Á∑ØÂ∫¶,ÁµåÂ∫¶„ÅÆÂΩ¢Âºè„Å´„Åó„Å¶„Åè„Å†„Åï„ÅÑ'); return; } } else if(city){ s.city=city; delete s.lat; delete s.lon; delete s.label; } else { alert('ÈÉΩÂ∏ÇÂêç „Åã Á∑ØÂ∫¶ÁµåÂ∫¶ „ÅÆ„Å©„Å°„Çâ„Åã„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ'); return; } store.save(s); document.getElementById('settings').style.display='none'; updateWeatherFromSettings(); });
    document.getElementById('notifyBtn').addEventListener('click', requestNotification);

    // ========= ÂàùÊúüÂåñ =========
    window.addEventListener('DOMContentLoaded', ()=>{ handleScroll(); cycleBackgrounds(); createCalendar(currentYear, currentMonth); });
    (async function initWeather(){ const s=store.load(); const first=!s.city && !s.lat && !s.lon; if(first && 'geolocation' in navigator){ try{ await useGeolocation(); }catch{} } updateWeatherFromSettings(); const cache=JSON.parse(localStorage.getItem('pwa.weather.cache')||'null'); if(cache){ renderWeather(cache.label, cache.wx); } })();
  </script>
</body>
</html>
